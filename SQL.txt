USE FRESH;
create database FRESH;

CREATE TABLE Rol(
ID_ROL_PK INT PRIMARY KEY auto_increment,
NOMBRE_ROL VARCHAR(128),
DESCRIPCION_ROL VARCHAR(254)
);

INSERT INTO ROL(NOMBRE_ROL,DESCRIPCION_ROL) VALUES('ADMINISTRADOR','ROL PARA EL ADMINISTRADOR DEL SISTEMA');

CREATE TABLE TipoTarima(
ID_TARIMA_PK INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(254),
PESO DECIMAL (10, 2),
ESTATUS CHAR(1) DEFAULT '1'
);

INSERT INTO TIPOTARIMA(NOMBRE,PESO) VALUES('AZUL',25);
INSERT INTO TIPOTARIMA(NOMBRE,PESO) VALUES('BLANCA',20);
INSERT INTO TIPOTARIMA(NOMBRE,PESO) VALUES('NEGRA',12);

CREATE TABLE TipoPresentacion(
ID_PRESENTACION_PK INT PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(254),
PESO DECIMAL (10, 2),
ESTATUS CHAR(1) DEFAULT '1'
);
SELECT * FROM TipoPresentacion;
INSERT INTO TipoPresentacion(NOMBRE,PESO) VALUES('ARPILLA',0);
INSERT INTO TipoPresentacion(NOMBRE,PESO) VALUES('CARTON',0.5);
INSERT INTO TipoPresentacion(NOMBRE,PESO) VALUES('PLASTICO',1.5);

CREATE TABLE Producto(
id_producto_pk INT PRIMARY KEY AUTO_INCREMENT,
nombre VARCHAR(254),
codigo VARCHAR(64),
tipo VARCHAR(64),
estatus varchar(8) default '1',
minimo int,
tiempo_entrega int,
fecha_alta datetime,
id_usuario_alta int,
fecha_eliminacion datetime,
id_usuario_eliminacion int,
clave_producto_servicio varchar(64),
clave_unidad varchar(64),
fracion_arancelaria varchar(64),

foreign key (id_usuario_alta) references  Usuario(ID),
foreign key (id_usuario_eliminacion) references  Usuario(ID)
);


CREATE TABLE Proveedor(
id_proveedor_pk INT PRIMARY KEY AUTO_INCREMENT,
nombre VARCHAR(254),
numero_telefono VARCHAR(64),
clave VARCHAR(64),
estatus varchar(8) default '1',
fecha_alta datetime,
id_usuario_alta int,
fecha_eliminacion datetime,
id_usuario_eliminacion int,
correo varchar(128),

foreign key (id_usuario_alta) references  Usuario(ID),
foreign key (id_usuario_eliminacion) references  Usuario(ID)
);



DROP TABLE Usuario;
CREATE TABLE Usuario(
ID INT PRIMARY KEY AUTO_INCREMENT,
USERNAME VARCHAR(32),
PASSWORD VARCHAR(128),
ROLE VARCHAR(16),
NOMBRE VARCHAR(254),
TELEFONO VARCHAR(128),
ID_ROL_FK int,
FECHA_ALTA date,
FECHA_BAJA date,
ID_USUARIO_ALTA_FK int,
ID_USUARIO_CANCEL_FK int,
FOREIGN KEY (ID_ROL_FK) REFERENCES Rol(ID_ROL_PK),
FOREIGN KEY (ID_USUARIO_ALTA_FK) REFERENCES Usuario(ID),
FOREIGN KEY (ID_USUARIO_CANCEL_FK) REFERENCES Usuario(ID)
);

insert into usuario(USERNAME,PASSWORD,ROLE,NOMBRE,TELEFONO,ID_ROL_FK,estatus) values('juan','$2a$10$hFeppyDnJds286fqJ5pWEuKG4ltzoFXf58BjawBSRFpeP9OTJu.y6','ADMIN','Juan de la Cruz','7727366220','1','1');

CREATE TABLE Cliente(
id_cliente_pk INT PRIMARY KEY AUTO_INCREMENT,
nombre VARCHAR(254),
numero_telefono VARCHAR(32),
direccion VARCHAR(254),
rfc VARCHAR(32),
codigo_postal VARCHAR(16),
estatus CHAR(1) DEFAULT '1',
fecha_alta DATETIME,
fecha_eliminacion DATETIME,
clave VARCHAR(128),
correo VARCHAR(128),
id_usuario_alta INT,
id_usuario_eliminacion INT,
foreign key (id_usuario_alta) references  Usuario(ID),
foreign key (id_usuario_eliminacion) references  Usuario(ID)
);
select * from menu;
CREATE TABLE MENU(
ID_MENU INT PRIMARY KEY AUTO_INCREMENT,
DESCRIPCION VARCHAR(254),
TIPO VARCHAR(128),
NIVEL VARCHAR(8),
URL_SISTEMA VARCHAR(254)
);
SELECT men.id_menu, men.descripcion, men.tipo, men.nivel, men.url_sistema FROM menu men LEFT JOIN acces_menu acces  ON acces.id_menu_fk = men.id_menu WHERE acces.ID_ROL_FK =1 ORDER BY men.nivel ASC
insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Catalogos','1','1','NULL');
insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Clientes','0','1.1','Fresh/clientes.xhtml');
insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Proveedores','0','1.2','Fresh/proveedores.xhtml');
insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Productos','0','1.3','Fresh/productos.xhtml');
insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Usuario','0','1.4','usuario.xhtml');

insert into menu(DESCRIPCION,TIPO,NIVEL,URL_SISTEMA) values('Catalogos','1','1','NULL');

select * from acces_menu;
CREATE TABLE acces_menu(
ID_ACCES_MENU_PK INT PRIMARY KEY AUTO_INCREMENT,
EDITAR VARCHAR(8),
ELIMINAR VARCHAR(8),
INSERTAR VARCHAR(8),
ID_MENU_FK INT,
ID_ROL_FK INT,

FOREIGN KEY (ID_MENU_FK) REFERENCES MENU(ID_MENU),
FOREIGN KEY (ID_ROL_FK) REFERENCES Rol(ID_ROL_PK)
);


CREATE TABLE OrdenTrabajo(
ID_ORDEN_PK INT PRIMARY KEY AUTO_INCREMENT,
NUMERO_ORDEN VARCHAR(128),
FECHA_ENTREGA DATETIME,
LOTE_PT VARCHAR(128),
OBSERVACIONES VARCHAR(254),
FECHA DATETIME,
ESTATUS CHAR(1) DEFAULT '1',
ID_USUARIO_FK INT,
foreign key (ID_USUARIO_FK) references  Usuario(ID)
);


CREATE TABLE OrdenTrabajoProducto(
ID_ORDEN_TRABAJO_PRODUCTO_PK INT PRIMARY KEY AUTO_INCREMENT,
CANTIDAD DECIMAL (10, 2),
tipo VARCHAR(254),
ESTATUS CHAR(1) DEFAULT '1',
ID_ORDEN_FK INT,
foreign key (ID_ORDEN_FK) references  OrdenTrabajo(ID_ORDEN_PK)
);


CREATE TABLE EntradaMateriaPrima(
ID_ENTRADA_MATERIA_PRIMA_PK INT PRIMARY KEY AUTO_INCREMENT,
FECHA DATETIME,
FECHA_CANCELACION DATETIME,
ESTATUS CHAR(1) DEFAULT '1',
NUMERO_ENTRADA INT,
PESO_BRUTO DECIMAL (10, 2),
PESO_NETO DECIMAL (10, 2),
TOTAL_TARA DECIMAL (10, 2),
TOTAL_CAJA DECIMAL (10, 2),
LOTE VARCHAR(128),
REMISION VARCHAR(128),
CANTIDAD DECIMAL (10, 2),
OBSERVACIONES VARCHAR(254),
ID_USUARIO_FK INT,
ID_USUARIO_CANCELA_FK INT,
ID_PROVEEDOR_FK INT,
ID_CLIENTE_FK INT,

foreign key (ID_USUARIO_FK) references  Usuario(ID),
foreign key (ID_USUARIO_CANCELA_FK) references  Usuario(ID),
foreign key (ID_PROVEEDOR_FK) references  Proveedor(id_proveedor_pk),
foreign key (ID_CLIENTE_FK) references  Cliente(id_cliente_pk)
);


CREATE TABLE EntradaMateriaPrimaProducto(
ID_ENTRADA_PRODUCTO_PK INT PRIMARY KEY AUTO_INCREMENT,
NUMERO_TARIMA INT,
CANTIDAD DECIMAL (10, 2),
PESO_BRUTO DECIMAL (10, 2),
PESO_NETO DECIMAL (10, 2),
PESO_TARIMA DECIMAL (10, 2),
PESO_PRESENTACION DECIMAL (10, 2),
TIPO_TARIMA INT,
TIPO_PRESENTACION INT,
ESTATUS CHAR(1) DEFAULT '1',
OBSERVACIONES VARCHAR(254),
ID_ENTRADA_MATERIA_PRIMA_FK INT,

foreign key (TIPO_TARIMA) references  TipoTarima(ID_TARIMA_PK),
foreign key (TIPO_PRESENTACION) references  TipoPresentacion(ID_PRESENTACION_PK),
foreign key (ID_ENTRADA_MATERIA_PRIMA_FK) references  EntradaMateriaPrima(ID_ENTRADA_MATERIA_PRIMA_PK)

);

CREATE TABLE TIPO_PRODUCTO(
ID_TIPO_PRODUCTO_PK INT PRIMARY KEY AUTO_INCREMENT,
DESCRIPCION VARCHAR(254),
PESO DECIMAL (10, 2)
);

CREATE TABLE LAVADO(
ID_LAVADO_PK  INT PRIMARY KEY AUTO_INCREMENT,
FECHA datetime,
ID_ORDEN_FK int,
ID_ENTRADA_MATERIA_PRIMA_FK int,
CANTIDAD decimal (10, 2),
PESO_NETO decimal (10, 2),
OBSERVACIONES varchar(254),
ID_TIPO_PRODUCTO_FK int,
ID_USUARIO_FK int,

foreign key (ID_USUARIO_FK) references  Usuario(ID),
foreign key (ID_TIPO_PRODUCTO_FK) references  TIPO_PRODUCTO(ID_TIPO_PRODUCTO_PK),
foreign key (ID_ORDEN_FK) references  OrdenTrabajo(ID_ORDEN_PK),
foreign key (ID_ENTRADA_MATERIA_PRIMA_FK) references  EntradaMateriaPrima(ID_ENTRADA_MATERIA_PRIMA_PK)
);

CREATE TABLE ORDEN_TRABAJO_LOTE(
ID_ENTRADA_MATERIA_PRIMA_FK INT ,
ID_ORDEN_FK INT ,
foreign key (ID_ORDEN_FK) references  OrdenTrabajo(ID_ORDEN_PK),
foreign key (ID_ENTRADA_MATERIA_PRIMA_FK) references  EntradaMateriaPrima(ID_ENTRADA_MATERIA_PRIMA_PK)
);

CREATE TABLE ENVASADO(
ID_ENVASADO_PK INT PRIMARY KEY AUTO_INCREMENT,
ID_ORDEN_FK INT ,
ID_ENTRADA_MATERIA_PRIMA_FK INT,
NUMERO_TARIMA INT,
CANTIDAD DECIMAL,
KILOS DECIMAL,
CANTIDAD_ENTREGADA DECIMAL,
KILOS_ENTREGADOS DECIMAL,
TAMANO INT,
ESTATUS CHAR(1),
TIPO_PRODUCTO_FK INT,
FECHA DATETIME,
FECHA_CANCELACION DATETIME,
ID_USUARIO_FK INT,
ID_USUARIO_CANCELA_FK INT,
FOREIGN KEY (ID_ORDEN_FK) REFERENCES ORDEN_TRABAJO (ID_ORDEN_PK),
FOREIGN KEY (TIPO_PRODUCTO_FK) REFERENCES TIPO_PRODUCTO(ID_TIPO_PRODUCTO_PK),
FOREIGN KEY (ID_ENTRADA_MATERIA_PRIMA_FK) REFERENCES entrada_materia_prima(ID_ENTRADA_MATERIA_PRIMA_PK),
FOREIGN KEY (ID_USUARIO_FK) REFERENCES USUARIO(ID),
FOREIGN KEY (ID_USUARIO_CANCELA_FK) REFERENCES USUARIO(ID)
);


CREATE TABLE SALIDA(
ID_SALIDA_PK INT PRIMARY KEY AUTO_INCREMENT,
FECHA DATETIME,
ID_CLIENTE_FK INT,
DATOS_CAMION VARCHAR(254),
CHOFER VARCHAR(254),
OBSERVACIONES VARCHAR(254),
ID_USUARIO_FK INT,
ID_USUARIO_CANCELA_FK INT,
FECHA_CANCELACION DATETIME,
ESTATUS CHAR(1) DEFAULT '1',

FOREIGN KEY (ID_CLIENTE_FK) REFERENCES CLIENTE(ID_CLIENTE_PK),
FOREIGN KEY (ID_USUARIO_FK) REFERENCES USUARIO (ID),
FOREIGN KEY (ID_USUARIO_CANCELA_FK) REFERENCES USUARIO (ID)

);

CREATE TABLE SALIDA_PRODUCTO(
ID_SALIDA_PRODUCTO_FK INT PRIMARY KEY AUTO_INCREMENT,
ID_SALIDA_FK INT,
ID_ENVASADO_FK INT,
CANTIDAD DECIMAL,
KILOS DECIMAL,
KILOS_BRUTO DECIMAL,
TARA DECIMAL,
ESTATUS CHAR(1) DEFAULT '1',
OBSERVACIONES VARCHAR(254),
ID_USUARIO_CANCELA_FK INT,
FECHA_CANCELACION DATETIME,

FOREIGN KEY (ID_SALIDA_FK) REFERENCES SALIDA(ID_SALIDA_PK),
FOREIGN KEY (ID_ENVASADO_FK) REFERENCES ENVASADO(ID_ENVASADO_PK),
FOREIGN KEY (ID_USUARIO_CANCELA_FK) REFERENCES USUARIO(ID)
);

